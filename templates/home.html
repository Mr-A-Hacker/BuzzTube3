{% extends "base.html" %}
{% block content %}

<!-- Splash Overlay -->
<div id="splash" class="splash">
  <h1 class="neon-text big-title splash-text">BuzzTube</h1>
</div>

<!-- Main Content -->
<div id="main-content" style="display:none;">
  <div class="container">
    <h1 class="neon-text big-title">BuzzTube Home</h1>

    <!-- Premium Request -->
    {% if premium == 0 %}
      <div class="premium-request">
        <form action="{{ url_for('request_premium') }}" method="POST">
          <button type="submit" class="btn three-d-btn">Request Premium</button>
        </form>
      </div>
    {% endif %}

    <!-- Video Feed -->
    <ul class="video-list">
      {% for v in videos %}
        <li class="card three-d-card">
          <!-- Video Title -->
          <h2 class="neon-text three-d-text">{{ v.title }}</h2>

          <!-- Uploader with Premium Badge -->
          <p class="meta">
            Uploaded by <strong>{{ v.uploader }}</strong>
            {% if v.premium == 1 %}
              <span class="premium-badge">★ Premium</span>
            {% endif %}
          </p>

          <!-- Video Preview -->
          {% if v.filepath %}
            <div class="three-d-video">
              <video id="video{{ v.id }}" controls width="100%" preload="metadata">
                <source src="{{ v.filepath }}" type="video/mp4">
                Your browser does not support the video tag.
              </video>
            </div>
          {% else %}
            <p class="flash warning">No video file available.</p>
          {% endif %}

          <!-- Actions -->
          <div class="actions three-d-actions">
            <form action="{{ url_for('like_video', id=v.id) }}" method="POST">
              <button type="submit" class="btn three-d-btn">Like ({{ v.likes }})</button>
            </form>
            <form action="{{ url_for('follow_user', username=v.uploader) }}" method="POST">
              <button type="submit" class="btn three-d-btn">Follow {{ v.uploader }}</button>
            </form>
            <a class="btn three-d-btn" href="{{ url_for('video', id=v.id) }}">Watch</a>
          </div>

          <!-- Comment Box -->
          <form action="{{ url_for('video', id=v.id) }}" method="POST" class="neon-form-inline">
            <div class="neon-field">
              <label class="neon-label" for="c-{{ v.id }}">Comment</label>
              <input id="c-{{ v.id }}" type="text" name="text" placeholder="Write a comment…" class="neon-input">
            </div>
            <button type="submit" class="btn three-d-btn">Post</button>
          </form>
        </li>
      {% else %}
        <li class="meta">No videos found. Upload one to get started!</li>
      {% endfor %}
    </ul>
  </div>
</div>

<!-- Styles -->
<style>
  .splash { position:fixed; inset:0; background:#000; display:flex; justify-content:center; align-items:center; z-index:9999; }
  .splash-text { animation: pulseScale 2s infinite; text-shadow: 0 0 25px #ff33aa, 0 0 50px #ff66cc, 0 0 80px #ff99dd; }
  @keyframes pulseScale { 0%{transform:scale(1);}25%{transform:scale(1.3);}50%{transform:scale(0.9);}75%{transform:scale(1.4);}100%{transform:scale(1);} }

  .three-d-card { background:#111; border-radius:16px; padding:20px; margin-bottom:25px; box-shadow:0 0 25px #ff33aa; transform:perspective(1200px) rotateX(6deg) rotateY(-4deg); transition:.4s; }
  .three-d-card:hover { transform:perspective(1200px) rotateX(0) rotateY(0) scale(1.06); box-shadow:0 0 60px #ff66cc; }

  .three-d-video video { border-radius:14px; box-shadow:0 0 35px #ff33aa; transform:rotateY(-8deg) translateZ(25px); transition:.4s; }
  .three-d-video video:hover { transform:rotateY(0) translateZ(40px) scale(1.05); box-shadow:0 0 70px #ff66cc; }

  .three-d-btn { background:#ff33aa; color:#fff; border:none; padding:12px 20px; border-radius:12px; font-weight:700; box-shadow:0 0 25px #ff33aa; transition:.3s; }
  .three-d-btn:hover { transform:scale(1.12); box-shadow:0 0 50px #ff66cc; background:#ff66cc; color:#000; }

  .neon-form-inline { display:flex; gap:14px; align-items:flex-end; margin-top:18px; flex-wrap:wrap; }
  .neon-field { flex:1; display:flex; flex-direction:column; gap:8px; }
  .neon-label { color:#ff66cc; font-weight:700; text-shadow:0 0 8px #ff33aa; }
  .neon-input { width:100%; padding:14px 18px; border:1px solid rgba(255,102,204,0.4); border-radius:14px; background:#0a0a0a; color:#ff66cc; font-weight:600; box-shadow:inset 0 0 12px rgba(255,51,170,0.4), 0 0 14px rgba(255,51,170,0.4); transition:.3s; }
  .neon-input::placeholder { color:#ff99dd; text-shadow:0 0 8px #ff33aa; font-style:italic; }
  .neon-input:focus { background:linear-gradient(160deg,#0a0a0a,#151515); border-color:#ff66cc; box-shadow:0 0 30px #ff66cc; transform:scale(1.05); }

  .premium-request { margin-bottom: 25px; }

  .premium-badge {
    color: #ff66cc;
    font-weight: bold;
    text-shadow: 0 0 8px #ff33aa, 0 0 16px #ff66cc;
    margin-left: 8px;
  }
</style>

<!-- Script -->
<script>
  function showSplash(callback) {
    const splash = document.getElementById("splash");
    const main = document.getElementById("main-content");
    splash.style.display = "flex";
    splash.style.opacity = 1;
    main.style.display = "none";
    setTimeout(() => {
      splash.style.opacity = 0;
      splash.style.transition = "opacity 1.2s ease";
      setTimeout(() => {
        splash.style.display = "none";
        main.style.display = "block";
        if (callback) callback();
      }, 1200);
    }, 1800);
  }
  window.addEventListener("load", () => { showSplash(); });
</script>

{% endblock %}
