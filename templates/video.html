{% extends "base.html" %}
{% block content %}

<div class="container">
  <!-- Video Title -->
  <div class="card">
    <h1 class="neon-text big-title">{{ v['title'] }}</h1>
    <p class="meta">Uploaded by {{ v['uploader'] }}</p>

    <!-- Video Player -->
    {% if v['filepath'] %}
      <video id="videoPlayer" width="100%" style="border-radius:12px; box-shadow:0 0 20px #6600ff;" preload="metadata">
        <source src="{{ v['filepath'] }}" type="video/mp4">
        Your browser does not support the video tag.
      </video>

      <!-- Custom Controls -->
      <div class="actions" style="margin-top:12px;">
        <button id="startBtn" class="btn">‚ñ∂Ô∏è Start</button>
        <button id="stopBtn" class="btn danger">‚èπ Stop</button>
      </div>

      <script>
        const video = document.getElementById("videoPlayer");
        const startBtn = document.getElementById("startBtn");
        const stopBtn = document.getElementById("stopBtn");

        startBtn.addEventListener("click", () => {
          video.play();
        });

        stopBtn.addEventListener("click", () => {
          video.pause();
          video.currentTime = 0; // reset to beginning
        });
      </script>
    {% else %}
      <p class="flash warning">No video file available.</p>
    {% endif %}

    <!-- Like & Follow Buttons -->
    <div class="actions" style="margin-top:12px;">
      <!-- Like -->
      <form action="{{ url_for('like_video', id=v['id']) }}" method="POST" style="display:inline;">
        <button type="submit" class="btn">üëç Like ({{ v['likes'] }})</button>
      </form>

      <!-- Follow -->
      <form action="{{ url_for('follow_user', username=v['uploader']) }}" method="POST" style="display:inline;">
        <button type="submit" class="btn">‚ûï Follow {{ v['uploader'] }}</button>
      </form>
    </div>
  </div>

  <!-- Comments Section -->
  <div class="card">
    <h2 class="neon-text">Comments</h2>

    <!-- Comment Form -->
    <form method="POST">
      <label for="text">Add a comment</label>
      <textarea id="text" name="text" placeholder="Write your comment..." required></textarea>
      <button type="submit" class="btn">Post Comment</button>
    </form>

    <!-- Comment List -->
    <ul class="comment-list">
      {% for c in comments %}
        <li>
          <strong>{{ c['user'] }}</strong>: {{ c['text'] }}
          <span class="meta">Comment #{{ c['id'] }}</span>
        </li>
      {% else %}
        <li class="meta">No comments yet. Be the first to comment!</li>
      {% endfor %}
    </ul>
  </div>
</div>

{% endblock %}
